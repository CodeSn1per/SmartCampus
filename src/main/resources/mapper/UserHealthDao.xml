<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.codesniper.smartcampus.dao.UserHealthDao">

    <resultMap type="com.codesniper.smartcampus.entity.UserHealth" id="UserHealthMap">
        <result property="id" column="ID" jdbcType="VARCHAR"/>
        <result property="userId" column="USER_ID" jdbcType="VARCHAR"/>
        <result property="temperature" column="TEMPERATURE" jdbcType="VARCHAR"/>
        <result property="isFever" column="IS_FEVER" jdbcType="VARCHAR"/>
        <result property="isContactRisk" column="IS_CONTACT_RISK" jdbcType="VARCHAR"/>
        <result property="healthCodeColor" column="HEALTH_CODE_COLOR" jdbcType="VARCHAR"/>
        <result property="localToday" column="LOCAL_TODAY" jdbcType="VARCHAR"/>
        <result property="isTrue" column="IS_TRUE" jdbcType="VARCHAR"/>
        <result property="createTime" column="CREATE_TIME" jdbcType="TIMESTAMP"/>
        <result property="updateTime" column="UPDATE_TIME" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="getUserHealthList" resultType="com.codesniper.smartcampus.entity.UserHealth" parameterType="com.codesniper.smartcampus.dto.UserHealthReq">
        SELECT a.NAME,b.* FROM T_USER_INFO a LEFT JOIN T_USER_HEALTH b ON a.USER_ID = b.USER_ID
        WHERE a.USER_ID=#{userId}
            <if test="isFever!=null and isFever!=''">
                AND IS_FEVER =#{isFever}
            </if>
            <if test="healthCodeColor!=null and healthCodeColor!=''">
                AND HEALTH_CODE_COLOR =#{healthCodeColor}
            </if>
            <if test="createTime!=null">
                AND CREATE_TIME =#{createTime}
            </if>
            ORDER BY b.CREATE_TIME DESC
    </select>

    <select id="getUserHealthDetail" resultType="com.codesniper.smartcampus.entity.UserHealth">
        SELECT a.NAME,b.* FROM T_USER_INFO a LEFT JOIN T_USER_HEALTH b ON a.USER_ID = b.USER_ID
        WHERE b.ID=#{id}
    </select>

    <update id="updateUserHealth" parameterType="com.codesniper.smartcampus.entity.UserHealth">
        UPDATE T_USER_HEALTH
        SET TEMPERATURE=#{temperature},
            CREATE_TIME=#{createTime},
            IS_CONTACT_RISK=#{isContactRisk},
            LOCAL_TODAY=#{localToday},
            HEALTH_CODE_COLOR=#{healthCodeColor},
            IS_TRUE=#{isTrue},
            IS_FEVER=#{isFever},
            UPDATE_TIME=#{updateTime}
        WHERE ID = #{id}
    </update>
</mapper>

